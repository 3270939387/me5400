# 数据量需求分析

## 当前配置
- `NUM_STEPS = 400` (每个 episode 的仿真步数)
- `CAPTURE_INTERVAL = 10` (每隔 10 步拍一张)
- **每个 episode ≈ 40 张图片**

---

## 数据量建议（分阶段）

### 阶段 1: 最小可行数据量（快速验证）
- **Episodes**: 20-30 个
- **总样本数**: 800-1,200 张图片
- **用途**: 
  - 验证代码流程是否正确
  - 检查数据格式是否有问题
  - 快速测试模型能否收敛
- **预期效果**: 模型可能过拟合，但能验证整个流程

### 阶段 2: 推荐数据量（实际训练）
- **Episodes**: 100-150 个
- **总样本数**: 4,000-6,000 张图片
- **用途**: 
  - 正式训练模型
  - 达到基本可用的效果
- **预期效果**: 
  - 成功率: 60-70%
  - 模型能学到基本规律，但可能不够鲁棒

### 阶段 3: 理想数据量（最佳效果）
- **Episodes**: 300-500 个
- **总样本数**: 12,000-20,000 张图片
- **用途**: 
  - 训练高性能模型
  - 确保泛化能力
- **预期效果**: 
  - 成功率: 80-90%
  - 模型鲁棒，能处理各种初始位置

---

## 数据多样性考虑

### 关键因素
1. **初始位置多样性**: 
   - 7 个关节的随机组合
   - 理论上组合数巨大，但实际有效区域有限
   - **建议**: 至少覆盖关节空间的 50-70%

2. **轨迹多样性**:
   - 不同初始位置 → marker 的不同运动轨迹
   - 不同视角、不同距离
   - **建议**: 确保有 marker 可见和不可见的样本

3. **数据平衡**:
   - 早期阶段（marker 不可见）: 30-40%
   - 中期阶段（marker 部分可见）: 30-40%
   - 后期阶段（marker 清晰可见）: 20-30%

---

## 实际计算

### 当前配置下的数据量
```
每个 episode:
  - 步数: 400
  - 采样间隔: 10
  - 图片数: 400 / 10 = 40 张

不同目标的数据量:
  - 最小 (30 episodes):  30 × 40 = 1,200 张
  - 推荐 (100 episodes): 100 × 40 = 4,000 张
  - 理想 (300 episodes): 300 × 40 = 12,000 张
```

### 如果调整采样频率
如果想增加数据量但不想增加 episodes：

```python
# 选项 1: 减少采样间隔（更密集采样）
CAPTURE_INTERVAL = 5  # 每个 episode 80 张图片
# 100 episodes = 8,000 张

# 选项 2: 增加 episode 步数
NUM_STEPS = 600  # 每个 episode 60 张（如果 CAPTURE_INTERVAL=10）
# 100 episodes = 6,000 张
```

---

## 数据收集策略

### 策略 1: 渐进式收集（推荐）
1. **第一批 (20-30 episodes)**: 
   - 快速验证流程
   - 检查数据质量
   - 训练一个小模型测试

2. **第二批 (70-100 episodes)**:
   - 如果第一批效果好，继续收集
   - 正式训练

3. **第三批 (200+ episodes)**:
   - 如果效果不够好，继续收集
   - 优化模型

### 策略 2: 一次性收集
- 直接收集 300+ episodes
- 优点: 数据充足，训练稳定
- 缺点: 如果数据有问题，发现得晚

---

## 经验法则

### 对于模仿学习（BC）
- **最少**: 1,000-2,000 样本（能跑起来）
- **推荐**: 5,000-10,000 样本（效果好）
- **理想**: 20,000+ 样本（最佳效果）

### 对于你的任务
- **任务复杂度**: 中等（视觉伺服，7维动作空间）
- **模型大小**: 中等（ResNet18 + MLP）
- **推荐**: **4,000-6,000 样本**（100-150 episodes）

---

## 数据质量 vs 数量

### 质量更重要
- **好的数据**: 100 episodes 可能比 300 个差数据效果好
- **确保**:
  - 每个 episode 都完整（从随机位置到 marker 可见）
  - 动作平滑（RMPflow 生成的质量高）
  - 图像清晰（相机参数正确）

### 数据检查清单
- [ ] 每个 episode 都有完整的轨迹
- [ ] marker 像素坐标计算正确
- [ ] 动作数据（delta_q）合理（不过大）
- [ ] 图像质量好（无模糊、曝光正常）

---

## 我的具体建议

### 第一阶段（验证）: 30 episodes
- 快速验证整个流程
- 检查数据格式
- 训练一个小模型测试

### 第二阶段（正式训练）: 100 episodes
- 如果第一阶段通过，收集到 100 个
- 开始正式训练
- 评估效果

### 第三阶段（优化）: 根据效果决定
- 如果成功率 < 60%: 继续收集到 200-300 个
- 如果成功率 60-80%: 可以尝试优化模型/超参数
- 如果成功率 > 80%: 可能不需要更多数据

---

## 时间估算

### 数据收集时间
- 每个 episode: 约 10-15 秒（400 步 × 1/60s）
- 30 episodes: 约 5-8 分钟
- 100 episodes: 约 15-25 分钟
- 300 episodes: 约 45-75 分钟

**注意**: 实际时间取决于你的硬件和 Isaac Sim 性能

---

## 总结

| 阶段 | Episodes | 样本数 | 用途 | 预期成功率 |
|------|----------|--------|------|-----------|
| 验证 | 30 | 1,200 | 验证流程 | N/A |
| 训练 | 100 | 4,000 | 正式训练 | 60-70% |
| 优化 | 300 | 12,000 | 最佳效果 | 80-90% |

**推荐**: 先收集 **100 episodes (4,000 样本)**，训练后根据效果决定是否需要更多。

